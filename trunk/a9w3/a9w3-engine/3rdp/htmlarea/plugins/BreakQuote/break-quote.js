// Copyright Dynarch.com 2003-2007
//
// This plugin is distributed under the GNU GPL.
function BreakQuote(editor,params){this.editor=editor;};BreakQuote._pluginInfo={name:"BreakQuote",version:"1.0",developer:"Mihai Bazon",developer_url:"http://dynarch.com/mishoo/",c_owner:"dynarch.com",sponsor:"dynarch.com",sponsor_url:"http://www.dynarch.com/",license:"GNU GPL"};BreakQuote.prototype.onKeyPress=function(ev){if(ev.keyCode!=13)return false;var i,sel,range,r2,df,p,editor=this.editor,qdiv=null,p=editor.getAllAncestors();for(i=0;i<p.length;++i)if(p[i].tagName.toLowerCase()=='div'&&/(^|\s+)quote(\s+|$)/.test(p[i].className))qdiv=p[i];if(qdiv){sel=editor._getSelection();range=editor._createRange(sel);if(!HTMLArea.is_ie){sel.removeAllRanges();r2=range.cloneRange();r2.setEndAfter(qdiv);df=r2.extractContents();p=editor._doc.createElement("p");p.appendChild(editor._doc.createElement("br"));df.insertBefore(p,df.firstChild);qdiv.parentNode.insertBefore(df,qdiv.nextSibling);range.selectNodeContents(p);range.collapse(true);sel.addRange(range);}else{r2=range.duplicate();r2.moveToElementText(qdiv);r2.setEndPoint("StartToStart",range);var txt=r2.htmlText.replace(/\s*<p>\s*<\/p>\s*/i,'');r2.pasteHTML('');p=editor._doc.createElement("p");p.innerHTML="&nbsp;<br />";qdiv.parentNode.insertBefore(p,qdiv.nextSibling);var tmp=qdiv.cloneNode(true);tmp.innerHTML=txt;qdiv.parentNode.insertBefore(tmp,p.nextSibling);range.moveToElementText(p);range.moveEnd('character',-1);range.pasteHTML('');range.select();}HTMLArea._stopEvent(ev);return true;}};